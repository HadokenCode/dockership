---
Title: Creating your Dockerfiles
---

Creating your Dockerfiles
=========================

This documentation assumes that you know what is a `Dockerfile` and how define one, if not please take a look to the [Dockerfile Reference](http://docs.docker.com/reference/builder/) before continue.

Those variables are replaced by Dockership before be submitted to the Docker server.

##Variables

Dockership introduces a series of variables into the Dockerfiles. This could be very useful to in some cases.

### Deployment information

This kind of variables are sourced from the internal process of Dockerfile given info about the deploy action.

* `$DOCKERSHIP_PROJECT`: Project name
* `$DOCKERSHIP_VCS`: Repository URLs, the `Repository` variable from the project.
* `$DOCKERSHIP_REV`: Revision identifier
* `$DOCKERSHIP_ENV`: Environment name where the Dockerfile is being deployed.

### etcd support

Dockership can be connected to a etcd server and allowing retrieve values directly into your Dockerfile.

The etcd keys are translated to variables. For example a key called `foo` will be converted in `$ETCD_FOO` or a key in a directory like `qux/bar` becomes `$ETCD_QUX_BAR`. If the key not is found then the variable will be an empty string.


## Bust the cache

For the most part, the image cache is incredibly helpful saving us a lot of time. However, this becomes tricky when the command results differs on each call.

Letâ€™s say we have the following Dockerfile:

```
FROM ubuntu:14.04

RUN apt-get update
RUN apt-get install -y build-essential git

RUN git clone https://github.com/mcuadros/flask-example.git
WORKDIR flask_example
RUN python setup.py install
```

The first time we build this all works as expected the `mcuadros/flask-example` is fletched with the latest version.

But then a developer commit something new to this repository and we want build the new image version and result is:

```
Step 3 : RUN git clone https://github.com/mcuadros/flask-example.git
 ---> Using cache
 ---> 2caac4df5e4a
```

This is very inconvenient since the builded image still have the old code. The most common option is use the `NoCache` options ignoring the cache generated by the first build, but in this case every time we builds the image `apt-get update` and `apt-get install -y build-essential git` will be executed being a suboptimal solution. 

We propose use `$DOCKERSHIP_REV` at the same `RUN` command. Now, if the version has changed, the cache will be ignored retrieving the new content.

```
FROM ubuntu:14.04

RUN apt-get update
RUN apt-get install -y build-essential git

RUN git clone https://github.com/mcuadros/flask-example.git && echo $DOCKERSHIP_REV
WORKDIR flask_example
RUN python setup.py install
```
